<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login | A2BA Music Group</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22 font-family=%22Arial, sans-serif%22 font-weight=%22bold%22 fill=%22black%22>A</text></svg>">

    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>

    <style>
        /* Reset Dasar */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background-color: #ffffff; 
            display: flex; 
            justify-content: center; 
            align-items: flex-start; 
            min-height: 100vh; 
        }

        /* -------------------------------------------
           ANIMASI LOADING AWAL (CEK SESI FIREBASE)
           ------------------------------------------- */
        .initial-loader {
            position: fixed;
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background-color: #ffffff;
            z-index: 9999; /* Paling atas, menutupi semua form */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s ease;
        }
        
        .spinner {
            width: 40px; 
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #000000;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        .initial-loader p {
            font-size: 14px;
            font-weight: 600;
            color: #555555;
            letter-spacing: 0.5px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* -------------------------------------------
           STYLE FORM LOGIN
           ------------------------------------------- */
        .login-wrapper {
            width: 100%;
            max-width: 400px; 
            padding: 0 20px 40px 20px; 
            margin-top: 0;
            text-align: center;
        }

        .logo-container {
            margin-top: 30px; 
            margin-bottom: 45px;
        }
        .logo-container img {
            height: 55px; 
            object-fit: contain;
        }

        /* Baris Input & Label di Atas */
        .input-group {
            margin-bottom: 25px;
            text-align: left; 
            position: relative;
        }
        
        .input-group label {
            display: block;
            font-size: 12px;
            color: #555555;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: bold;
            margin-bottom: 8px; 
        }

        .input-group input {
            width: 100%;
            background-color: #f7f7f7; 
            border: none;
            border-bottom: 2px solid #dddddd; 
            border-radius: 4px 4px 0 0;
            font-size: 15px;
            color: #000000;
            font-family: inherit;
            font-weight: 500;
            padding: 15px; 
            outline: none;
            transition: 0.2s;
        }
        
        .input-group input[type="password"],
        .input-group input.password-visible {
            padding-right: 45px; 
        }

        .input-group input:focus {
            border-bottom-color: #000000; 
            background-color: #f0f0f0;
        }

        .input-group input:-webkit-autofill {
            -webkit-box-shadow: 0 0 0 30px #f0f0f0 inset !important;
            -webkit-text-fill-color: #000000 !important;
            border-radius: 4px 4px 0 0;
        }

        /* Ikon Toggle Password (Mata) */
        .toggle-password {
            position: absolute;
            right: 15px;
            bottom: 12px;
            background: none;
            border: none;
            cursor: pointer;
            color: #888888;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            transition: 0.2s;
        }
        .toggle-password:hover {
            color: #000000;
        }
        .toggle-password svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        /* Area Cloudflare Turnstile */
        .turnstile-container {
            margin-bottom: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 80px; 
        }
        
        .cf-status-text {
            font-size: 12px;
            font-weight: bold;
            color: #e67e22; 
            margin-top: 10px;
        }
        .cf-status-text.success {
            color: #27ae60; 
        }

        /* Tombol Login */
        .button-container {
            margin-bottom: 25px;
        }
        .btn-login {
            background-color: #cccccc; 
            color: #ffffff;
            border: none;
            border-radius: 50px; 
            padding: 14px 0;
            width: 100%; 
            font-size: 14px;
            font-weight: bold;
            letter-spacing: 1px;
            cursor: not-allowed; 
            transition: 0.3s;
        }
        .btn-login.active {
            background-color: #000000; 
            cursor: pointer;
        }
        .btn-login.active:hover {
            background-color: #333333;
        }

        .forgot-link {
            color: #000000;
            font-size: 13px;
            font-weight: 500;
            text-decoration: none;
            transition: 0.2s;
        }
        .forgot-link:hover {
            color: #666666;
            text-decoration: underline;
        }

        /* MODAL POPUP */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 99999; display: none; justify-content: center; align-items: center; padding: 20px; }
        .modal-box { background: #fff; padding: 30px; border-radius: 8px; max-width: 400px; width: 100%; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .modal-icon { font-size: 2.5rem; margin-bottom: 10px; }
        .modal-title { font-size: 1.2rem; font-weight: bold; margin-bottom: 10px; color: #000; }
        .modal-desc { font-size: 0.9rem; color: #555; margin-bottom: 20px; line-height: 1.5; }
        
        .btn-modal-action { display: block; width: 100%; padding: 12px; border-radius: 4px; font-weight: bold; margin-bottom: 10px; text-decoration: none; cursor: pointer; border: none; font-size: 14px; }
        .btn-black { background: #000; color: #fff; }
        .btn-black:hover { background: #333; }
    </style>
</head>
<body>

    <div id="initialLoader" class="initial-loader">
        <div class="spinner"></div>
        <p id="loaderText">Memeriksa keamanan & sesi...</p>
    </div>

    <div class="login-wrapper">
        
        <div class="logo-container">
            <img src="3128.png" alt="A2BA Logo">
        </div>

        <form id="loginForm" autocomplete="off">
            
            <input type="email" style="display:none" name="fakeemail">
            <input type="password" style="display:none" name="fakepassword">

            <div class="input-group">
                <label for="email">Email</label>
                <input type="email" id="email" autocomplete="username" required>
            </div>

            <div class="input-group">
                <label for="password">Password</label>
                <input type="password" id="password" autocomplete="current-password" required>
                
                <button type="button" class="toggle-password" id="btnTogglePassword" onclick="togglePasswordVisibility()">
                    <svg id="eyeIcon" viewBox="0 0 24 24">
                        <path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/>
                    </svg>
                </button>
            </div>

            <div class="turnstile-container">
                <div class="cf-turnstile" data-sitekey="0x4AAAAAACf2lK9vDKOHkazJ" data-callback="turnstileSukses"></div>
                <div id="cf-status" class="cf-status-text">‚è≥ Sedang memverifikasi keamanan...</div>
            </div>

            <div class="button-container">
                <button type="submit" id="btnLogin" class="btn-login" disabled>LOGIN</button>
            </div>

            <a href="#" class="forgot-link" onclick="bukaWaLupaPassword(event)">Forgot your password?</a>

        </form>

    </div>

    <div id="alertModal" class="modal-overlay">
        <div class="modal-box">
            <div id="alertIcon" class="modal-icon">‚ö†Ô∏è</div>
            <div id="alertTitle" class="modal-title">Peringatan</div>
            <div id="alertDesc" class="modal-desc">Pesan peringatan di sini.</div>
            <button class="btn-modal-action btn-black" onclick="tutupModal('alertModal')">Mengerti</button>
        </div>
    </div>

    <script>
        function tampilkanAlert(judul, pesan, ikon = '‚ö†Ô∏è') {
            document.getElementById('alertTitle').innerText = judul;
            document.getElementById('alertDesc').innerText = pesan;
            document.getElementById('alertIcon').innerText = ikon;
            document.getElementById('alertModal').style.display = 'flex';
        }

        function tutupModal(idModal) {
            document.getElementById(idModal).style.display = 'none';
        }

        function togglePasswordVisibility() {
            var passwordInput = document.getElementById("password");
            var eyeIcon = document.getElementById("eyeIcon");

            if (passwordInput.type === "password") {
                passwordInput.type = "text";
                passwordInput.classList.add('password-visible');
                eyeIcon.innerHTML = '<path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>';
            } else {
                passwordInput.type = "password";
                passwordInput.classList.remove('password-visible');
                eyeIcon.innerHTML = '<path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/>';
            }
        }

        function turnstileSukses() {
            var statusText = document.getElementById('cf-status');
            var btnLogin = document.getElementById('btnLogin');

            statusText.innerText = "‚úÖ Keamanan terverifikasi";
            statusText.classList.add('success');
            
            btnLogin.removeAttribute('disabled');
            btnLogin.classList.add('active');
        }

        function bukaWaLupaPassword(event) {
            event.preventDefault();
            document.getElementById('alertTitle').innerText = "Lupa Password";
            document.getElementById('alertDesc').innerText = "Untuk mereset password, silakan hubungi Admin melalui WhatsApp.";
            document.getElementById('alertIcon').innerText = "üîê";
            
            var btnAlert = document.querySelector('#alertModal .btn-black');
            btnAlert.innerText = "Lanjut ke WhatsApp";
            btnAlert.onclick = function() {
                window.open("https://wa.me/6285385184618?text=Halo%20Admin%20A2BA,%20saya%20lupa%20password%20akun%20saya.", "_blank");
                tutupModal('alertModal');
                
                setTimeout(() => {
                    btnAlert.innerText = "Mengerti";
                    btnAlert.onclick = function() { tutupModal('alertModal'); };
                }, 500);
            };
            
            document.getElementById('alertModal').style.display = 'flex';
        }
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCVSvYDeBdQb7dT1YrQhLPRIDb12DcyF-I",
            authDomain: "aldotune-5dfd0.firebaseapp.com",
            databaseURL: "https://aldotune-5dfd0-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "aldotune-5dfd0",
            storageBucket: "aldotune-5dfd0.firebasestorage.app",
            messagingSenderId: "271598081160",
            appId: "1:271598081160:web:30c803c825421f90597b3d",
            measurementId: "G-LYV2T35KPT"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        
        // Element Loader
        const initialLoader = document.getElementById('initialLoader');
        const loaderText = document.getElementById('loaderText');

        // CEK SESI SAAT HALAMAN DIMUAT (Loading Screen Aktif)
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Jika sudah login, ubah teks dan langsung alihkan
                loaderText.innerText = "Mengalihkan ke Dasbor...";
                window.location.href = 'rumah.html';
            } else {
                // Jika BELUM login, hilangkan layar loading agar user bisa isi form
                initialLoader.style.opacity = '0';
                setTimeout(() => {
                    initialLoader.style.display = 'none';
                }, 500); // Menunggu transisi fade out selesai
            }
        });

        // PROSES SUBMIT FORM LOGIN
        document.getElementById('loginForm').addEventListener('submit', function(event) {
            event.preventDefault(); 

            var turnstileResponse = document.querySelector('[name="cf-turnstile-response"]');
            if (!turnstileResponse || turnstileResponse.value === "") {
                tampilkanAlert("Akses Ditolak", "Verifikasi keamanan Cloudflare belum selesai! Silakan tunggu atau centang kotak keamanan.", "üõ°Ô∏è");
                return;
            }

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const btnLogin = document.getElementById('btnLogin');

            btnLogin.innerText = "MEMPROSES...";
            btnLogin.style.cursor = "wait";

            signInWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    // Berhasil login, lemparkan ke rumah.html
                    window.location.href = 'rumah.html';
                })
                .catch((error) => {
                    const errorCode = error.code;
                    
                    btnLogin.innerText = "LOGIN";
                    btnLogin.style.cursor = "pointer";

                    // Deteksi Error Firebase
                    if(errorCode === 'auth/invalid-credential' || errorCode === 'auth/wrong-password' || errorCode === 'auth/user-not-found') {
                        tampilkanAlert("Gagal Login", "Email atau Password yang Anda masukkan salah. Silakan periksa kembali.", "‚ùå");
                    } else if (errorCode === 'auth/too-many-requests') {
                        tampilkanAlert("Akun Dikunci", "Terlalu banyak percobaan gagal. Akun Anda dikunci sementara demi keamanan, silakan coba beberapa saat lagi.", "üîí");
                    } else if (errorCode === 'auth/user-disabled') {
                        tampilkanAlert("Akun Dinonaktifkan", "Akun Anda telah dinonaktifkan oleh Admin. Silakan hubungi Admin A2BA melalui WhatsApp untuk bantuan lebih lanjut.", "üö´");
                    } else {
                        tampilkanAlert("Kesalahan Sistem", "Terjadi kesalahan: " + error.message, "‚ö†Ô∏è");
                    }
                });
        });
    </script>

</body>
</html>